# Very basic testing setup.
#
# For most of the code examples, we don't have unit tests.
# Thats why we are testing classical "Can we install it",
# go vet, staticcheck, go fmt.
#
# It is not covering everything, but basic things like
# version conflicts, typos, etc.
name: Go Testing

on:
  push:
  workflow_dispatch:
  schedule:
    - cron: "5 1 * * *"

jobs:
  go:
    name: Go testing
    strategy:
      fail-fast: false
      matrix:
        dir: [
          "mongodb/go",
          "mssql/go",
          "nats/go",
          "oracle/go",
          "redis/go",
          "rabbitmq/go",
          "postgresql/go"
        ]
    runs-on: ubuntu-20.04
    defaults:
      run:
        working-directory: ${{ matrix.dir }}

    steps:
      - uses: actions/checkout@v3.1.0
      - uses: actions/setup-go@v3.3.1
        with:
          go-version:  '1.19'

      - name: Run go build .
        run: go build

      - name: Run go fmt
        if: runner.os != 'Windows'
        run: diff -u <(echo -n) <(gofmt -d -s .)

      - name: Run go vet
        run: go vet ./...

      - name: Run staticcheck
        uses: dominikh/staticcheck-action@v1.2.0
        with:
          version: "2022.1.3"
          install-go: false
          cache-key: staticcheck
          working-directory: ${{ matrix.dir }}
